(()=>{var e={};e.id=204,e.ids=[204,220],e.modules={4722:e=>{"use strict";e.exports=require("next-auth/react")},8732:e=>{"use strict";e.exports=require("react/jsx-runtime")},12830:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(8732),a=r(82341);function i(){return(0,s.jsxs)(a.Html,{lang:"en",children:[(0,s.jsxs)(a.Head,{children:[(0,s.jsx)("meta",{charSet:"UTF-8"}),(0,s.jsx)("meta",{name:"description",content:"CertifiedSkill.org - Your Certification Platform"})]}),(0,s.jsxs)("body",{className:"antialiased",children:[(0,s.jsx)(a.Main,{}),(0,s.jsx)(a.NextScript,{})]})]})}},15806:e=>{"use strict";e.exports=require("next-auth/next")},16382:e=>{"use strict";e.exports=require("next-auth/providers/credentials")},21231:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>x,default:()=>u,getServerSideProps:()=>g,getStaticPaths:()=>p,getStaticProps:()=>m,reportWebVitals:()=>h,routeModule:()=>j,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>b,unstable_getStaticParams:()=>y,unstable_getStaticPaths:()=>f,unstable_getStaticProps:()=>S});var a=r(63885),i=r(80237),n=r(81413),o=r(12830),d=r(97036),l=r(82078),c=e([d,l]);[d,l]=c.then?(await c)():c;let u=(0,n.M)(l,"default"),m=(0,n.M)(l,"getStaticProps"),p=(0,n.M)(l,"getStaticPaths"),g=(0,n.M)(l,"getServerSideProps"),x=(0,n.M)(l,"config"),h=(0,n.M)(l,"reportWebVitals"),S=(0,n.M)(l,"unstable_getStaticProps"),f=(0,n.M)(l,"unstable_getStaticPaths"),y=(0,n.M)(l,"unstable_getStaticParams"),w=(0,n.M)(l,"unstable_getServerProps"),b=(0,n.M)(l,"unstable_getServerSideProps"),j=new a.PagesRouteModule({definition:{kind:i.A.PAGES,page:"/exam/[id]/start",pathname:"/exam/[id]/start",bundlePath:"",filename:""},components:{App:d.default,Document:o.default},userland:l});s()}catch(e){s(e)}})},22326:e=>{"use strict";e.exports=require("react-dom")},27910:e=>{"use strict";e.exports=require("stream")},27912:e=>{"use strict";e.exports=require("next/head")},29021:e=>{"use strict";e.exports=require("fs")},29443:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(56037),a=r.n(s);if(!process.env.MONGO_URI)throw Error("Please define the MONGO_URI environment variable");let i=global.mongoose;i||(i=global.mongoose={conn:null,promise:null});let n=async function(){return i.conn||(i.promise||(i.promise=a().connect(process.env.MONGO_URI).then(e=>e.connection)),i.conn=await i.promise),i.conn}},33873:e=>{"use strict";e.exports=require("path")},40361:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},41415:e=>{"use strict";e.exports=import("sonner")},50687:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(8732),a=r(82015);let i=function({onCheatingDetected:e,detectionThreshold:t=3e3}){let[r,i]=(0,a.useState)(!1),[n,o]=(0,a.useState)(0);return(0,s.jsx)(s.Fragment,{children:r&&(0,s.jsxs)("div",{className:"fixed top-4 left-4 bg-green-600 text-green px-8 py-8 rounded shadow-md",children:["Warning: Cheating Detected! (Count: ",n,")"]})})}},52768:()=>{},56037:e=>{"use strict";e.exports=require("mongoose")},74075:e=>{"use strict";e.exports=require("zlib")},77187:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(56037),a=r.n(s);let i=new(a()).Schema({title:{type:String,required:!0},questions:[{questionText:{type:String,required:!0},options:[{type:String,required:!0}],correctAnswer:{type:String,required:!0}}],duration:{type:Number,required:!0},startTime:{type:Date,required:!0},endTime:{type:Date,required:!0}}),n=a().models.Exam||a().model("Exam",i)},82015:e=>{"use strict";e.exports=require("react")},82078:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>S,getServerSideProps:()=>f});var a=r(8732),i=r(82015),n=r(44233),o=r(27912),d=r.n(o),l=r(50687),c=r(4722),u=r(41415),m=r(15806),p=r(93475),g=r(29443),x=r(77187),h=e([u,p]);function S({exam:e}){let{data:t,status:r}=(0,c.useSession)();(0,n.useRouter)();let[s,o]=(0,i.useState)({}),[u,m]=(0,i.useState)(!1),[p,g]=(0,i.useState)(0),[x,h]=(0,i.useState)(0),[S,f]=(0,i.useState)(0),[w,b]=(0,i.useState)(20),j=()=>{h(e=>e+(20-w)),S<e.questions.length-1&&(f(e=>e+1),b(20))},v=t=>{o(e=>({...e,[S]:t})),S<e.questions.length-1&&j()},q=async()=>{if(u)return;m(!0);let r=e.questions.reduce((e,t,r)=>s[r]===t.correctAnswer?e+1:e,0),a=e.questions.length,i={userId:t.user.id,examId:e._id,userName:t.user.name,examName:e.title,score:r,total:a,passed:r>=40,timeTaken:x,cheatingCount:p,createdAt:new Date};await y(i)};if(!e.questions||0===e.questions.length)return(0,a.jsx)("p",{className:"text-center mt-20 text-gray-600",children:"No questions found."});let N=e.questions[S];return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(l.A,{onCheatingDetected:()=>{g(e=>e+1)}}),(0,a.jsx)(d(),{children:(0,a.jsxs)("title",{children:[e.title," | Exam Portal"]})}),(0,a.jsx)("header",{className:"bg-white shadow py-4",children:(0,a.jsx)("div",{className:"container mx-auto px-4",children:(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-800",children:e.title})})}),(0,a.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-lg",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-medium text-gray-700",children:["Question ",S+1," of ",e.questions.length]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-500",style:{width:`${w/20*100}%`}})}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Time remaining: ",w," seconds"]})]})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("p",{className:"text-lg text-gray-800 font-semibold",children:N.questionText})}),(0,a.jsx)("div",{className:"space-y-4",children:N.options.map((e,t)=>(0,a.jsxs)("label",{className:`flex items-center p-4 border rounded-lg cursor-pointer transition-colors 
                  ${s[S]===e?"border-indigo-600 bg-indigo-50":"border-gray-300 bg-white"}`,children:[(0,a.jsx)("input",{type:"radio",name:`question-${S}`,value:e,onChange:()=>v(e),checked:s[S]===e,className:"form-radio h-5 w-5 text-indigo-600 mr-3"}),(0,a.jsx)("span",{className:"text-gray-700",children:e})]},t))}),S===e.questions.length-1&&(0,a.jsx)("button",{onClick:()=>{q()},className:"mt-8 w-full py-3 text-black bg-indigo-600 hover:bg-indigo-700 rounded-lg shadow transition-colors",children:"Submit Exam"})]})})]})}async function f(e){if(!await (0,m.getServerSession)(e.req,e.res,p.N))return{redirect:{destination:"/sign-in",permanent:!1}};try{await (0,g.A)();let{id:t}=e.params,r=await x.A.findById(t).lean();if(!r||!r.questions)return{notFound:!0};return r._id=r._id.toString(),r.createdAt&&(r.createdAt=r.createdAt.toISOString()),r.updatedAt&&(r.updatedAt=r.updatedAt.toISOString()),r.startTime&&delete r.startTime,r.endTime&&delete r.endTime,r.questions=r.questions.map(e=>({...e,_id:e._id.toString(),createdAt:e.createdAt?new Date(e.createdAt).toISOString():null,updatedAt:e.updatedAt?new Date(e.updatedAt).toISOString():null})),{props:{exam:r}}}catch(e){return console.error("Error fetching exam:",e),{notFound:!0}}}async function y(e){try{let t=await fetch("/api/exams/result",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),cache:"no-store"}),r=await t.json();if(!t.ok){u.toast.error(r.message||"Error submitting your exam results. Please try again later."),console.error(r.message);return}if(e.passed){u.toast.success("Congratulations! You passed the exam. Your certificate is being generated.");let t=await fetch("/api/certificate/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.userId,examId:e.examId,userName:e.userName,examName:e.examName,passed:e.passed}),cache:"no-store"});if(t.ok){let e=await t.blob(),r=window.URL.createObjectURL(e);window.open(r,"_blank")}else{let e=await t.json();u.toast.error("There was an error generating your certificate. Please try again later."),console.error(e.message)}}else u.toast.error("Unfortunately, you did not pass the exam. Please try again.")}catch(e){u.toast.error("An unexpected error occurred during submission. Please contact support."),console.error("Submission error:",e)}}[u,p]=h.then?(await h)():h,s()}catch(e){s(e)}})},93139:e=>{"use strict";e.exports=import("bcryptjs")},93475:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{N:()=>c});var a=r(16382),i=r.n(a),n=r(93139),o=r(93553),d=r(29443),l=e([n]);n=(l.then?(await l)():l)[0];let c={session:{strategy:"jwt"},providers:[i()({name:"Credentials",credentials:{email:{label:"Email",type:"text",placeholder:"you@example.com"},password:{label:"Password",type:"password"}},async authorize(e){if(!e||!e.email||!e.password)throw Error("Email and Password must be provided");await (0,d.A)();let t=await o.A.findOne({email:e.email});if(!t)throw Error("No user found with that email.");if(!await n.default.compare(e.password,t.password))throw Error("Invalid password.");return t}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t._id.toString(),e.email=t.email,e.name=t.name,e.role=t.role||"student"),e),session:async({session:e,token:t})=>(t&&(e.user={id:t.id,email:t.email,name:t.name,role:t.role||"student"}),e)},pages:{signIn:"/sign-in"},secret:process.env.NEXTAUTH_SECRET};s()}catch(e){s(e)}})},93553:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(56037),a=r.n(s);let i=new(a()).Schema({name:{type:String,required:!0},email:{type:String,required:!0,unique:!0},password:{type:String,required:!1}}),n=a().models.User||a().model("User",i)},95704:e=>{"use strict";e.exports=import("react-loading-skeleton")},97036:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>c});var a=r(8732);r(52768);var i=r(4722),n=r(41415),o=r(99846),d=r(95704);r(79631);var l=e([n,o,d]);function c({Component:e,pageProps:{session:t,...r}}){return(0,a.jsx)(i.SessionProvider,{session:t,children:(0,a.jsx)(d.SkeletonTheme,{baseColor:"#e0e7ef",highlightColor:"#f3f4f6",children:(0,a.jsxs)("div",{className:"overflow-x-hidden",children:[(0,a.jsx)(e,{...r}),(0,a.jsx)(n.Toaster,{richColors:!0}),(0,a.jsx)(o.Analytics,{})]})})})}[n,o,d]=l.then?(await l)():l,s()}catch(e){s(e)}})},99846:e=>{"use strict";e.exports=import("@vercel/analytics/react")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[341,917,233],()=>r(21231));module.exports=s})();