(()=>{var e={};e.id=781,e.ids=[220,636,781],e.modules={361:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},687:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(8732),a=r(2015);let i=function({onCheatingDetected:e,detectionThreshold:t=3e3}){let[r,i]=(0,a.useState)(!1),[n,o]=(0,a.useState)(0);return(0,s.jsx)(s.Fragment,{children:r&&(0,s.jsxs)("div",{className:"fixed top-4 left-4 bg-red-600 text-black px-4 py-2 rounded shadow-md",children:["Warning: Cheating Detected! (Count: ",n,")"]})})}},2015:e=>{"use strict";e.exports=require("react")},2326:e=>{"use strict";e.exports=require("react-dom")},2768:()=>{},2830:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(8732),a=r(2341);function i(){return(0,s.jsxs)(a.Html,{lang:"en",children:[(0,s.jsxs)(a.Head,{children:[(0,s.jsx)("meta",{charSet:"UTF-8"}),(0,s.jsx)("meta",{name:"description",content:"CertifySkill.org - Your Certification Platform"})]}),(0,s.jsxs)("body",{className:"antialiased",children:[(0,s.jsx)(a.Main,{}),(0,s.jsx)(a.NextScript,{})]})]})}},3139:e=>{"use strict";e.exports=import("bcryptjs")},3475:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{N:()=>m});var a=r(6382),i=r.n(a),n=r(8123),o=r.n(n),l=r(3553),u=r(9443),c=r(3139),d=e([c]);c=(d.then?(await d)():d)[0];let m={session:{strategy:"jwt"},providers:[o()({clientId:process.env.GITHUB_ID,clientSecret:process.env.GITHUB_SECRET}),i()({name:"Credentials",credentials:{email:{label:"Email",type:"text",placeholder:"you@example.com"},password:{label:"Password",type:"password"}},async authorize(e){try{await (0,u.A)();let t=await l.A.findOne({email:e?.email});if(!t)throw Error("No user found with that email.");if(!await c.default.compare(e?.password||"",t.password))throw Error("Invalid password.");return t}catch(e){return console.error("Authorize error:",e),null}}})],callbacks:{signIn:async({account:e,profile:t})=>(e?.provider!=="github"||(await (0,u.A)(),await l.A.findOne({email:t?.email})||await l.A.create({name:t?.name||t?.login,email:t?.email,role:"student"})),!0),jwt:async({token:e,user:t})=>(t&&(e.id=t._id.toString(),e.email=t.email,e.name=t.name,e.role=t.role||"student"),e),session:async({session:e,token:t})=>(t&&(e.user={id:t.id,email:t.email,name:t.name,role:t.role||"student"}),e)},pages:{signIn:"/sign-in"},secret:process.env.NEXTAUTH_SECRET};s()}catch(e){s(e)}})},3553:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(6037),a=r.n(s);let i=new(a()).Schema({name:{type:String,required:!0},email:{type:String,required:!0,unique:!0},password:{type:String,required:!1}}),n=a().models.User||a().model("User",i)},3873:e=>{"use strict";e.exports=require("path")},4075:e=>{"use strict";e.exports=require("zlib")},4211:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>g,getServerSideProps:()=>b});var a=r(8732),i=r(2015),n=r(4233),o=r(7912),l=r.n(o),u=r(687),c=r(4722),d=r(5806),m=r(3475),p=r(9443),x=r(7187),h=e([m]);function g({exam:e}){let{data:t,status:r}=(0,c.useSession)();(0,n.useRouter)();let[s,o]=(0,i.useState)({}),[d,m]=(0,i.useState)(!1),[p,x]=(0,i.useState)(0),[h,g]=(0,i.useState)(0),[b,f]=(0,i.useState)(0),[w,y]=(0,i.useState)(20),v=()=>{g(e=>e+(20-w)),b<e.questions.length-1&&(f(e=>e+1),y(20))},q=t=>{o(e=>({...e,[b]:t})),b<e.questions.length-1&&v()},j=async()=>{if(d)return;m(!0);let r=e.questions.reduce((e,t,r)=>s[r]===t.correctAnswer?e+1:e,0),a=e.questions.length,i={userId:t?.user?.id,examId:e._id,userName:t?.user?.name,examName:e.title,score:r,total:a,passed:r>=40,timeTaken:h,cheatingCount:p,createdAt:new Date};await S(i)};if(!e.questions||0===e.questions.length)return(0,a.jsx)("p",{children:"No questions found."});let N=e.questions[b];return(0,a.jsx)("div",{className:"relative",children:"loading"===r?(0,a.jsx)("p",{children:"Loading..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{onCheatingDetected:()=>{x(e=>e+1)}}),(0,a.jsxs)("div",{className:"p-6 max-w-3xl mx-auto",children:[(0,a.jsx)(l(),{children:(0,a.jsx)("title",{children:e.title})}),(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:e.title}),(0,a.jsxs)("h2",{className:"text-xl mb-4",children:["Question ",b+1," of ",e.questions.length]}),(0,a.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-4 mb-6 border border-gray-200",children:[(0,a.jsx)("p",{className:"text-lg font-medium mb-3",children:N.questionText}),(0,a.jsx)("div",{children:N.options.map((e,t)=>(0,a.jsxs)("label",{className:"block p-2 mb-2 border rounded cursor-pointer hover:bg-gray-100",children:[(0,a.jsx)("input",{type:"radio",name:`question-${b}`,value:e,onChange:()=>q(e),checked:s[b]===e,className:"mr-2"}),e]},t))}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Time left for this question: ",w," seconds"]})}),b===e.questions.length-1&&(0,a.jsx)("button",{onClick:()=>{j()},className:"px-6 py-2 mt-4 text-black bg-blue-500 hover:bg-blue-600 rounded shadow",children:"Submit"})]})]})]})})}async function S(e){try{let t=await fetch("/api/exams/result",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),cache:"no-store"}),r=await t.json();if(!t.ok){console.error(r.message);return}if(e.passed){let t=await fetch("/api/certificate/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.userId,examId:e.examId,userName:e.userName,examName:e.examName,passed:e.passed}),cache:"no-store"});if(t.ok){let e=await t.blob(),r=window.URL.createObjectURL(e);window.open(r,"_blank")}else{let e=await t.json();console.error(e.message)}}else alert("You did not pass the exam.")}catch(e){console.error("Submission error:",e)}}async function b(e){if(!await (0,d.getServerSession)(e.req,e.res,m.N))return{redirect:{destination:"/sign-in",permanent:!1}};try{await (0,p.A)();let t=await x.A.findById(e.params.id);if(!t||!t.questions)return{notFound:!0};return{props:{exam:JSON.parse(JSON.stringify(t))}}}catch(e){return console.error("Error fetching exam:",e),{notFound:!0}}}m=(h.then?(await h)():h)[0],s()}catch(e){s(e)}})},4722:e=>{"use strict";e.exports=require("next-auth/react")},5806:e=>{"use strict";e.exports=require("next-auth/next")},6037:e=>{"use strict";e.exports=require("mongoose")},6382:e=>{"use strict";e.exports=require("next-auth/providers/credentials")},7187:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(6037),a=r.n(s);let i=new(a()).Schema({title:{type:String,required:!0},questions:[{questionText:{type:String,required:!0},options:[{type:String,required:!0}],correctAnswer:{type:String,required:!0}}],duration:{type:Number,required:!0},startTime:{type:Date,required:!0},endTime:{type:Date,required:!0}}),n=a().models.Exam||a().model("Exam",i)},7651:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>h,default:()=>d,getServerSideProps:()=>x,getStaticPaths:()=>p,getStaticProps:()=>m,reportWebVitals:()=>g,routeModule:()=>v,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>y,unstable_getStaticParams:()=>f,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>S});var a=r(3885),i=r(237),n=r(1413),o=r(2830),l=r(9542),u=r(4211),c=e([u]);u=(c.then?(await c)():c)[0];let d=(0,n.M)(u,"default"),m=(0,n.M)(u,"getStaticProps"),p=(0,n.M)(u,"getStaticPaths"),x=(0,n.M)(u,"getServerSideProps"),h=(0,n.M)(u,"config"),g=(0,n.M)(u,"reportWebVitals"),S=(0,n.M)(u,"unstable_getStaticProps"),b=(0,n.M)(u,"unstable_getStaticPaths"),f=(0,n.M)(u,"unstable_getStaticParams"),w=(0,n.M)(u,"unstable_getServerProps"),y=(0,n.M)(u,"unstable_getServerSideProps"),v=new a.PagesRouteModule({definition:{kind:i.A.PAGES,page:"/exam/[id]",pathname:"/exam/[id]",bundlePath:"",filename:""},components:{App:l.default,Document:o.default},userland:u});s()}catch(e){s(e)}})},7910:e=>{"use strict";e.exports=require("stream")},7912:e=>{"use strict";e.exports=require("next/head")},8123:e=>{"use strict";e.exports=require("next-auth/providers/github")},8732:e=>{"use strict";e.exports=require("react/jsx-runtime")},9021:e=>{"use strict";e.exports=require("fs")},9443:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(6037),a=r.n(s);if(!process.env.MONGO_URI)throw Error("Please define the MONGO_URI environment variable");let i=global.mongoose;i||(i=global.mongoose={conn:null,promise:null});let n=async function(){return i.conn||(i.promise||(i.promise=a().connect(process.env.MONGO_URI,{useNewUrlParser:!0,useUnifiedTopology:!0}).then(()=>a().connection)),i.conn=await i.promise),i.conn}},9542:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(8732);r(2768);var a=r(4722);function i({Component:e,pageProps:{session:t,...r}}){return(0,s.jsx)(a.SessionProvider,{session:t,children:(0,s.jsx)(e,{...r})})}}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[341,155,233],()=>r(7651));module.exports=s})();