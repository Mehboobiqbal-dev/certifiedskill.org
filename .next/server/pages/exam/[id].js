(()=>{var e={};e.id=781,e.ids=[220,636,781],e.modules={4722:e=>{"use strict";e.exports=require("next-auth/react")},8732:e=>{"use strict";e.exports=require("react/jsx-runtime")},12830:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(8732),a=r(82341);function i(){return(0,s.jsxs)(a.Html,{lang:"en",children:[(0,s.jsxs)(a.Head,{children:[(0,s.jsx)("meta",{charSet:"UTF-8"}),(0,s.jsx)("meta",{name:"description",content:"CertifiedSkill.org - Your Certification Platform"})]}),(0,s.jsxs)("body",{className:"antialiased",children:[(0,s.jsx)(a.Main,{}),(0,s.jsx)(a.NextScript,{})]})]})}},15806:e=>{"use strict";e.exports=require("next-auth/next")},16382:e=>{"use strict";e.exports=require("next-auth/providers/credentials")},19542:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>u});var a=r(8732);r(52768);var i=r(4722),n=r(41415),o=r(99846),c=e([n,o]);function u({Component:e,pageProps:{session:t,...r}}){return(0,a.jsxs)(i.SessionProvider,{session:t,children:[(0,a.jsx)(e,{...r}),(0,a.jsx)(n.Toaster,{richColors:!0})]})}[n,o]=c.then?(await c)():c,s()}catch(e){s(e)}})},22326:e=>{"use strict";e.exports=require("react-dom")},24211:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>b,getServerSideProps:()=>f});var a=r(8732),i=r(82015),n=r(44233),o=r(27912),c=r.n(o),u=r(50687),d=r(4722),l=r(41415),m=r(15806),p=r(93475),x=r(29443),h=r(77187),g=e([l,p]);function b({exam:e}){let{data:t,status:r}=(0,d.useSession)();(0,n.useRouter)();let[s,o]=(0,i.useState)({}),[l,m]=(0,i.useState)(!1),[p,x]=(0,i.useState)(0),[h,g]=(0,i.useState)(0),[b,f]=(0,i.useState)(0),[y,w]=(0,i.useState)(20),v=()=>{g(e=>e+(20-y)),b<e.questions.length-1&&(f(e=>e+1),w(20))},q=t=>{o(e=>({...e,[b]:t})),b<e.questions.length-1&&v()},j=async()=>{if(l)return;m(!0);let r=e.questions.reduce((e,t,r)=>s[r]===t.correctAnswer?e+1:e,0),a=e.questions.length,i={userId:t?.user?.id,examId:e._id,userName:t?.user?.name,examName:e.title,score:r,total:a,passed:r>=40,timeTaken:h,cheatingCount:p,createdAt:new Date};await S(i)};if(!e.questions||0===e.questions.length)return(0,a.jsx)("p",{children:"No questions found."});let N=e.questions[b];return(0,a.jsx)("div",{className:"relative",children:"loading"===r?(0,a.jsx)("p",{children:"Loading..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{onCheatingDetected:()=>{x(e=>e+1)}}),(0,a.jsxs)("div",{className:"p-6 max-w-3xl mx-auto",children:[(0,a.jsx)(c(),{children:(0,a.jsx)("title",{children:e.title})}),(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:e.title}),(0,a.jsxs)("h2",{className:"text-xl mb-4",children:["Question ",b+1," of ",e.questions.length]}),(0,a.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-4 mb-6 border border-gray-200",children:[(0,a.jsx)("p",{className:"text-lg font-medium mb-3",children:N.questionText}),(0,a.jsx)("div",{children:N.options.map((e,t)=>(0,a.jsxs)("label",{className:"block p-2 mb-2 border rounded cursor-pointer hover:bg-gray-100",children:[(0,a.jsx)("input",{type:"radio",name:`question-${b}`,value:e,onChange:()=>q(e),checked:s[b]===e,className:"mr-2"}),e]},t))}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Time left for this question: ",y," seconds"]})}),b===e.questions.length-1&&(0,a.jsx)("button",{onClick:()=>{j()},className:"px-6 py-2 mt-4 text-black bg-blue-500 hover:bg-blue-600 rounded shadow",children:"Submit"})]})]})]})})}async function S(e){try{let t=await fetch("/api/exams/result",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),cache:"no-store"}),r=await t.json();if(!t.ok){l.toast.error("There was an error submitting your exam results. Please try again later."),console.error(r.message);return}if(e.passed){l.toast.success("Congratulations! You have passed the exam. Your certificate is being generated.");let t=await fetch("/api/certificate/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.userId,examId:e.examId,userName:e.userName,examName:e.examName,passed:e.passed}),cache:"no-store"});if(t.ok){let e=await t.blob(),r=window.URL.createObjectURL(e);window.open(r,"_blank")}else{let e=await t.json();l.toast.error("An error occurred while generating your certificate. Please try again later."),console.error(e.message)}}else l.toast.error("Regretfully, you did not pass the exam. Kindly review your responses and consider retaking the exam.")}catch(e){l.toast.error("An unexpected error occurred during submission. Please contact support."),console.error("Submission error:",e)}}async function f(e){if(!await (0,m.getServerSession)(e.req,e.res,p.N))return{redirect:{destination:"/sign-in",permanent:!1}};try{await (0,x.A)();let t=await h.A.findById(e.params.id);if(!t||!t.questions)return{notFound:!0};return{props:{exam:JSON.parse(JSON.stringify(t))}}}catch(e){return console.error("Error fetching exam:",e),{notFound:!0}}}[l,p]=g.then?(await g)():g,s()}catch(e){s(e)}})},27910:e=>{"use strict";e.exports=require("stream")},27912:e=>{"use strict";e.exports=require("next/head")},29021:e=>{"use strict";e.exports=require("fs")},29443:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(56037),a=r.n(s);if(!process.env.MONGO_URI)throw Error("Please define the MONGO_URI environment variable");let i=global.mongoose;i||(i=global.mongoose={conn:null,promise:null});let n=async function(){return i.conn||(i.promise||(i.promise=a().connect(process.env.MONGO_URI).then(e=>e.connection)),i.conn=await i.promise),i.conn}},33873:e=>{"use strict";e.exports=require("path")},37651:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>h,default:()=>l,getServerSideProps:()=>x,getStaticPaths:()=>p,getStaticProps:()=>m,reportWebVitals:()=>g,routeModule:()=>v,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>f,unstable_getStaticPaths:()=>S,unstable_getStaticProps:()=>b});var a=r(63885),i=r(80237),n=r(81413),o=r(12830),c=r(19542),u=r(24211),d=e([c,u]);[c,u]=d.then?(await d)():d;let l=(0,n.M)(u,"default"),m=(0,n.M)(u,"getStaticProps"),p=(0,n.M)(u,"getStaticPaths"),x=(0,n.M)(u,"getServerSideProps"),h=(0,n.M)(u,"config"),g=(0,n.M)(u,"reportWebVitals"),b=(0,n.M)(u,"unstable_getStaticProps"),S=(0,n.M)(u,"unstable_getStaticPaths"),f=(0,n.M)(u,"unstable_getStaticParams"),y=(0,n.M)(u,"unstable_getServerProps"),w=(0,n.M)(u,"unstable_getServerSideProps"),v=new a.PagesRouteModule({definition:{kind:i.A.PAGES,page:"/exam/[id]",pathname:"/exam/[id]",bundlePath:"",filename:""},components:{App:c.default,Document:o.default},userland:u});s()}catch(e){s(e)}})},40361:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},41415:e=>{"use strict";e.exports=import("sonner")},50687:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(8732),a=r(82015);let i=function({onCheatingDetected:e,detectionThreshold:t=3e3}){let[r,i]=(0,a.useState)(!1),[n,o]=(0,a.useState)(0);return(0,s.jsx)(s.Fragment,{children:r&&(0,s.jsxs)("div",{className:"fixed top-4 left-4 bg-red-600 text-black px-4 py-2 rounded shadow-md",children:["Warning: Cheating Detected! (Count: ",n,")"]})})}},52768:()=>{},56037:e=>{"use strict";e.exports=require("mongoose")},74075:e=>{"use strict";e.exports=require("zlib")},77187:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(56037),a=r.n(s);let i=new(a()).Schema({title:{type:String,required:!0},questions:[{questionText:{type:String,required:!0},options:[{type:String,required:!0}],correctAnswer:{type:String,required:!0}}],duration:{type:Number,required:!0},startTime:{type:Date,required:!0},endTime:{type:Date,required:!0}}),n=a().models.Exam||a().model("Exam",i)},82015:e=>{"use strict";e.exports=require("react")},93139:e=>{"use strict";e.exports=import("bcryptjs")},93475:(e,t,r)=>{"use strict";r.a(e,async(e,s)=>{try{r.d(t,{N:()=>d});var a=r(16382),i=r.n(a),n=r(93139),o=r(93553),c=r(29443),u=e([n]);n=(u.then?(await u)():u)[0];let d={session:{strategy:"jwt"},providers:[i()({name:"Credentials",credentials:{email:{label:"Email",type:"text",placeholder:"you@example.com"},password:{label:"Password",type:"password"}},async authorize(e){if(!e||!e.email||!e.password)throw Error("Email and Password must be provided");await (0,c.A)();let t=await o.A.findOne({email:e.email});if(!t)throw Error("No user found with that email.");if(!await n.default.compare(e.password,t.password))throw Error("Invalid password.");return t}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t._id.toString(),e.email=t.email,e.name=t.name,e.role=t.role||"student"),e),session:async({session:e,token:t})=>(t&&(e.user={id:t.id,email:t.email,name:t.name,role:t.role||"student"}),e)},pages:{signIn:"/sign-in"},secret:process.env.NEXTAUTH_SECRET};s()}catch(e){s(e)}})},93553:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(56037),a=r.n(s);let i=new(a()).Schema({name:{type:String,required:!0},email:{type:String,required:!0,unique:!0},password:{type:String,required:!1}}),n=a().models.User||a().model("User",i)},99846:e=>{"use strict";e.exports=import("@vercel/analytics/react")}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[341,155,233],()=>r(37651));module.exports=s})();