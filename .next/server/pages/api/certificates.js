"use strict";(()=>{var e={};e.id=499,e.ids=[499],e.modules={37:e=>{e.exports=import("uuid")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return i}});var i=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},10375:(e,t,i)=>{i.a(e,async(e,n)=>{try{i.r(t),i.d(t,{config:()=>f,default:()=>l,routeModule:()=>u});var r=i(33480),o=i(8667),a=i(86435),s=i(25450),c=e([s]);s=(c.then?(await c)():c)[0];let l=(0,a.M)(s,"default"),f=(0,a.M)(s,"config"),u=new r.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/certificates",pathname:"/api/certificates",bundlePath:"",filename:""},userland:s});n()}catch(e){n(e)}})},25450:(e,t,i)=>{i.a(e,async(e,n)=>{try{i.r(t),i.d(t,{default:()=>g});var r=i(81278),o=i.n(r),a=i(29021),s=i.n(a),c=i(33873),l=i.n(c),f=i(37),u=i(64689),d=e([f]);async function g(e,t){let i;try{i=await (0,u.A)()}catch(e){return console.error("Database connection error:",e),t.status(500).json({message:"Database connection failed"})}let n=i.db||i.useDb("myDatabase");if("GET"===e.method){let{certificateNumber:i,userEmail:r,userId:a}=e.query;if(i)try{let e=await n.collection("certificates").findOne({certificateId:i});if(!e)return t.status(404).json({message:"Certificate not found"});t.setHeader("Content-Type","application/pdf"),t.setHeader("Content-Disposition",'inline; filename="certificate.pdf"');let r=new(o())({size:"A4",layout:"landscape",margins:{top:50,bottom:50,left:50,right:50}});r.pipe(t);let{width:a,height:c}=r.page;r.rect(0,0,a,c).fill("#ffffff"),r.rect(40,40,a-80,c-80).lineWidth(2).stroke("#333333"),r.fillColor("#333333").font("Helvetica-Bold").fontSize(20).text("CertifiedSkill.org",0,60,{align:"center"}),r.font("Helvetica").fontSize(12).text("Your trusted partner in professional certifications",{align:"center"}),r.moveDown(2),r.font("Helvetica-Bold").fontSize(36).text("Certificate of Achievement",{align:"center",underline:!0}),r.moveDown(1.5),r.font("Helvetica").fontSize(18).text("This certificate verifies that",{align:"center"}),r.moveDown(.5),r.font("Helvetica-Bold").fontSize(28).text(e.userName,{align:"center"}),r.moveDown(.5),r.font("Helvetica").fontSize(18).text("has successfully passed the exam:",{align:"center"}),r.moveDown(.5),r.font("Helvetica-Bold").fontSize(24).text(e.examName,{align:"center"}),r.moveDown(1.5),r.font("Helvetica").fontSize(14).text("This is an authentic certificate digitally issued by CertifiedSkill.org.",{align:"center"}),r.text("Visit CertifiedSkill.org.com to verify its authenticity.",{align:"center"});let f=new Date(e.issuedAt).toLocaleDateString();r.font("Helvetica").fontSize(10).text(`Certificate ID: ${e.certificateId}`,50,c-70,{align:"left"}),r.font("Helvetica").fontSize(10).text(`Issued on: ${f}`,-50,c-70,{align:"right"});let u=c-100,d=a-200,g=l().join(process.cwd(),"public/image.png");s().existsSync(g)&&r.image(g,d,u-40,{width:100,height:50}),r.moveTo(d,u).lineTo(d+100,u).stroke("#333333"),r.font("Helvetica").fontSize(10).text("Authorized Signature",d,u+5,{align:"center",width:100}),r.end();return}catch(e){return console.error("Error generating certificate PDF:",e),t.status(500).json({message:"Internal Server Error"})}if(!r&&!a)return t.status(400).json({message:"Please provide a userEmail or userId in the query string"});let c={};r&&(c.userEmail=r),a&&(c.userId=a);try{let e=await n.collection("certificates").find(c).toArray();return console.log(`Found ${e.length} certificate(s) for query:`,c),t.status(200).json(e)}catch(e){return console.error("Error fetching certificates:",e),t.status(500).json({message:"Internal Server Error"})}}else{if("POST"!==e.method)return t.status(405).json({message:"Method Not Allowed"});let{userId:i,userName:r,examId:o,examName:a,passed:s,userEmail:c}=e.body;if(!0!==s&&"true"!==s)return console.error("Exam not passed:",e.body),t.status(400).json({message:"User did not pass the exam"});try{let e=await n.collection("certificates").findOne({userId:i,examId:o});return e?(console.log("Existing certificate found:",e),e.certificateId||(e.certificateId=(0,f.v4)(),await n.collection("certificates").updateOne({_id:e._id},{$set:{certificateId:e.certificateId}}),console.log("Updated certificate with new certificateId:",e.certificateId))):(e={userId:i,userName:r,examId:o,examName:a,certificateId:(0,f.v4)(),issuedAt:new Date,...c&&{userEmail:c}},await n.collection("certificates").insertOne(e),console.log("Created new certificate:",e)),t.status(200).json(e)}catch(e){return console.error("Certificate generation error:",e),t.status(500).json({message:"Internal Server Error"})}}}f=(d.then?(await d)():d)[0],n()}catch(e){n(e)}})},29021:e=>{e.exports=require("fs")},33480:(e,t,i)=>{e.exports=i(75600)},33873:e=>{e.exports=require("path")},56037:e=>{e.exports=require("mongoose")},64689:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(56037),r=i.n(n);if(!process.env.MONGO_URI)throw Error("Please define the MONGO_URI environment variable");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let a=async function(){return o.conn||(o.promise||(o.promise=r().connect(process.env.MONGO_URI).then(e=>e.connection)),o.conn=await o.promise),o.conn}},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},81278:e=>{e.exports=require("pdfkit")},86435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var i=t(t.s=10375);module.exports=i})();