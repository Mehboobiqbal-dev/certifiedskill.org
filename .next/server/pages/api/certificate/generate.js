"use strict";(()=>{var e={};e.id=630,e.ids=[630],e.modules={37:e=>{e.exports=import("uuid")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return i}});var i=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},20862:(e,t,i)=>{i.a(e,async(e,n)=>{try{i.r(t),i.d(t,{default:()=>l});var o=i(81278),a=i.n(o),r=i(37),c=i(64689),s=e([r]);async function l(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method Not Allowed"});try{let{userId:i,userName:n,examId:o,examName:s,passed:l}=e.body;if(!l)return t.status(400).json({message:"User did not pass the exam"});let f=await (0,c.A)(),d=f.db||f.useDb("myDatabase"),u=await d.collection("certificates").findOne({userId:i,examId:o});u?u.certificateId||(u.certificateId=(0,r.v4)(),await d.collection("certificates").updateOne({_id:u._id},{$set:{certificateId:u.certificateId}})):(u={userId:i,userName:n,examId:o,examName:s,certificateId:(0,r.v4)(),issuedAt:new Date},await d.collection("certificates").insertOne(u)),t.setHeader("Content-Type","application/pdf"),t.setHeader("Content-Disposition",'inline; filename="certificate.pdf"');let p=new(a())({size:"A4",layout:"landscape",margins:{top:50,bottom:50,left:50,right:50}});p.pipe(t);let{width:g,height:m}=p.page;p.rect(0,0,g,m).fill("#ffffff"),p.rect(40,40,g-80,m-80).lineWidth(2).stroke("#333333"),p.fillColor("#333333").font("Helvetica-Bold").fontSize(20).text("CertifiedSkill.org",0,60,{align:"center"}),p.font("Helvetica").fontSize(12).text("Your trusted partner in professional certifications",{align:"center"}),p.moveDown(2),p.font("Helvetica-Bold").fontSize(36).text("Certificate of Achievement",{align:"center",underline:!0}),p.moveDown(1.5),p.font("Helvetica").fontSize(18).text("This certificate verifies that",{align:"center"}),p.moveDown(.5),p.font("Helvetica-Bold").fontSize(28).text(u.userName,{align:"center"}),p.moveDown(.5),p.font("Helvetica").fontSize(18).text("has successfully passed the exam:",{align:"center"}),p.moveDown(.5),p.font("Helvetica-Bold").fontSize(24).text(u.examName,{align:"center"}),p.moveDown(1.5),p.font("Helvetica").fontSize(14).text("This is an authentic certificate digitally issued by CertifiedSkill.org.",{align:"center"}),p.text("Visit CertifiedSkill.org.com to verify its authenticity.",{align:"center"});let v=new Date(u.issuedAt).toLocaleDateString();p.font("Helvetica").fontSize(10).text(`Certificate ID: ${u.certificateId}`,50,m-70,{align:"left"}),p.font("Helvetica").fontSize(10).text(`Issued on: ${v}`,-50,m-70,{align:"right"});let h=m-100,A=g-200,P=path.join(process.cwd(),"public/image.png");fs.existsSync(P)&&p.image(P,A,h-40,{width:100,height:50}),p.moveTo(A,h).lineTo(A+100,h).stroke("#333333"),p.font("Helvetica").fontSize(10).text("Authorized Signature",A,h+5,{align:"center",width:100}),p.end()}catch(e){console.error("Error verifying certificate:",e),t.status(500).json({message:"Internal Server Error"})}}r=(s.then?(await s)():s)[0],n()}catch(e){n(e)}})},33480:(e,t,i)=>{e.exports=i(75600)},37830:(e,t,i)=>{i.a(e,async(e,n)=>{try{i.r(t),i.d(t,{config:()=>f,default:()=>l,routeModule:()=>d});var o=i(33480),a=i(8667),r=i(86435),c=i(20862),s=e([c]);c=(s.then?(await s)():s)[0];let l=(0,r.M)(c,"default"),f=(0,r.M)(c,"config"),d=new o.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/certificate/generate",pathname:"/api/certificate/generate",bundlePath:"",filename:""},userland:c});n()}catch(e){n(e)}})},56037:e=>{e.exports=require("mongoose")},64689:(e,t,i)=>{i.d(t,{A:()=>r});var n=i(56037),o=i.n(n);if(!process.env.MONGO_URI)throw Error("Please define the MONGO_URI environment variable");let a=global.mongoose;a||(a=global.mongoose={conn:null,promise:null});let r=async function(){return a.conn||(a.promise||(a.promise=o().connect(process.env.MONGO_URI).then(e=>e.connection)),a.conn=await a.promise),a.conn}},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},81278:e=>{e.exports=require("pdfkit")},86435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var i=t(t.s=37830);module.exports=i})();