"use strict";(()=>{var e={};e.id=630,e.ids=[630],e.modules={37:e=>{e.exports=import("uuid")},862:(e,t,i)=>{i.a(e,async(e,n)=>{try{i.r(t),i.d(t,{default:()=>s});var o=i(1278),r=i.n(o),a=i(37),c=i(4689),l=e([a]);async function s(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method Not Allowed"});try{let{userId:i,userName:n,examId:o,examName:l,passed:s}=e.body;if(!s)return t.status(400).json({message:"User did not pass the exam"});let f=await (0,c.A)(),d=f.db||f.useDb("myDatabase"),u=await d.collection("certificates").findOne({userId:i,examId:o});u?u.certificateId||(u.certificateId=(0,a.v4)(),await d.collection("certificates").updateOne({_id:u._id},{$set:{certificateId:u.certificateId}})):(u={userId:i,userName:n,examId:o,examName:l,certificateId:(0,a.v4)(),issuedAt:new Date},await d.collection("certificates").insertOne(u)),t.setHeader("Content-Type","application/pdf"),t.setHeader("Content-Disposition",'inline; filename="certificate.pdf"');let p=new(r())({size:"A4",layout:"landscape",margins:{top:50,bottom:50,left:50,right:50}});p.pipe(t);let{width:g,height:v}=p.page;p.rect(0,0,g,v).fill("#ffffff"),p.rect(40,40,g-80,v-80).lineWidth(2).stroke("#333333"),p.fillColor("#333333").font("Helvetica-Bold").fontSize(20).text("GetCertified",0,60,{align:"center"}),p.font("Helvetica").fontSize(12).text("Your trusted partner in professional certifications",{align:"center"}),p.moveDown(2),p.font("Helvetica-Bold").fontSize(36).text("Certificate of Achievement",{align:"center",underline:!0}),p.moveDown(1.5),p.font("Helvetica").fontSize(18).text("This certificate verifies that",{align:"center"}),p.moveDown(.5),p.font("Helvetica-Bold").fontSize(28).text(n,{align:"center"}),p.moveDown(.5),p.font("Helvetica").fontSize(18).text("has successfully passed the exam:",{align:"center"}),p.moveDown(.5),p.font("Helvetica-Bold").fontSize(24).text(l,{align:"center"}),p.moveDown(1.5),p.font("Helvetica").fontSize(14).text("This is an authentic certificate digitally issued by GetCertified.",{align:"center"}),p.text("Visit GetCertified.com to verify its authenticity.",{align:"center"});let m=new Date(u.issuedAt).toLocaleDateString();p.font("Helvetica").fontSize(10).text(`Certificate ID: ${u.certificateId}`,50,v-70,{align:"left"}),p.font("Helvetica").fontSize(10).text(`Issued on: ${m}`,-50,v-70,{align:"right"});let h=v-100,A=g-200;p.moveTo(A,h).lineTo(A+100,h).stroke("#333333"),p.font("Helvetica").fontSize(10).text("Authorized Signature",A,h+5,{align:"center",width:100});let P=v-100-50;p.circle(100,P+50,50).lineWidth(2).stroke("#003366"),p.circle(100,P+50,50).fillOpacity(.1).fill("#003366"),p.fillOpacity(1),p.font("Helvetica-Bold").fontSize(14).fillColor("#003366").text("GetCertify",50,P+50-7,{width:100,align:"center"}),p.end()}catch(e){console.error("Certificate generation error:",e),t.status(500).json({message:"Internal Server Error"})}}a=(l.then?(await l)():l)[0],n()}catch(e){n(e)}})},1278:e=>{e.exports=require("pdfkit")},3480:(e,t,i)=>{e.exports=i(5600)},4689:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(6037),o=i.n(n);if(!process.env.MONGO_URI)throw Error("Please define the MONGO_URI environment variable");let r=global.mongoose;r||(r=global.mongoose={conn:null,promise:null});let a=async function(){return r.conn||(r.promise||(r.promise=o().connect(process.env.MONGO_URI,{useNewUrlParser:!0,useUnifiedTopology:!0}).then(()=>o().connection)),r.conn=await r.promise),r.conn}},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6037:e=>{e.exports=require("mongoose")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})},7830:(e,t,i)=>{i.a(e,async(e,n)=>{try{i.r(t),i.d(t,{config:()=>f,default:()=>s,routeModule:()=>d});var o=i(3480),r=i(8667),a=i(6435),c=i(862),l=e([c]);c=(l.then?(await l)():l)[0];let s=(0,a.M)(c,"default"),f=(0,a.M)(c,"config"),d=new o.PagesAPIRouteModule({definition:{kind:r.A.PAGES_API,page:"/api/certificate/generate",pathname:"/api/certificate/generate",bundlePath:"",filename:""},userland:c});n()}catch(e){n(e)}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return i}});var i=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var i=t(t.s=7830);module.exports=i})();