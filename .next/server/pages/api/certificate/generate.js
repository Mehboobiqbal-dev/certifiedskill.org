"use strict";(()=>{var e={};e.id=630,e.ids=[630],e.modules={37:e=>{e.exports=import("uuid")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return i}});var i=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},20862:(e,t,i)=>{i.a(e,async(e,n)=>{try{i.r(t),i.d(t,{default:()=>p});var r=i(81278),o=i.n(r),a=i(37),c=i(64689),s=i(33873),l=i.n(s),f=i(29021),d=i.n(f),u=e([a]);async function p(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method Not Allowed"});try{let{userId:i,userName:n,examId:r,examName:s,passed:f}=e.body;if(!f)return t.status(400).json({message:"User did not pass the exam"});let u=await (0,c.A)(),p=u.db||u.useDb("myDatabase"),g=await p.collection("certificates").findOne({userId:i,examId:r});g?g.certificateId||(g.certificateId=(0,a.v4)(),await p.collection("certificates").updateOne({_id:g._id},{$set:{certificateId:g.certificateId}})):(g={userId:i,userName:n,examId:r,examName:s,certificateId:(0,a.v4)(),issuedAt:new Date},await p.collection("certificates").insertOne(g)),t.setHeader("Content-Type","application/pdf"),t.setHeader("Content-Disposition",'inline; filename="certificate.pdf"');let m=new(o())({size:"A4",layout:"landscape",margins:{top:50,bottom:50,left:50,right:50}}),v=l().join(process.cwd(),"public","certificate");d().existsSync(v)||d().mkdirSync(v,{recursive:!0});let h=`${g.certificateId}.pdf`,x=l().join(v,h),A=d().createWriteStream(x);m.pipe(A),m.pipe(t);let{width:S,height:P}=m.page;m.rect(0,0,S,P).fill("#ffffff"),m.rect(40,40,S-80,P-80).lineWidth(2).stroke("#333333"),m.fillColor("#333333").font("Helvetica-Bold").fontSize(20).text("CertifiedSkill.org",0,60,{align:"center"}),m.font("Helvetica").fontSize(12).text("Your trusted partner in professional certifications",{align:"center"}),m.moveDown(2),m.font("Helvetica-Bold").fontSize(36).text("Certificate of Achievement",{align:"center",underline:!0}),m.moveDown(1.5),m.font("Helvetica").fontSize(18).text("This certificate verifies that",{align:"center"}),m.moveDown(.5),m.font("Helvetica-Bold").fontSize(28).text(g.userName,{align:"center"}),m.moveDown(.5),m.font("Helvetica").fontSize(18).text("has successfully passed the exam:",{align:"center"}),m.moveDown(.5),m.font("Helvetica-Bold").fontSize(24).text(g.examName,{align:"center"}),m.moveDown(1.5),m.font("Helvetica").fontSize(14).text("This is an authentic certificate digitally issued by CertifiedSkill.org.",{align:"center"}),m.text("Visit CertifiedSkill.org.com to verify its authenticity.",{align:"center"});let w=new Date(g.issuedAt).toLocaleDateString();m.font("Helvetica").fontSize(10).text(`Certificate ID: ${g.certificateId}`,50,P-70,{align:"left"}),m.font("Helvetica").fontSize(10).text(`Issued on: ${w}`,-50,P-70,{align:"right"});let y=P-100,I=S-200,b=l().join(process.cwd(),"public/image.png");d().existsSync(b)&&m.image(b,I,y-40,{width:100,height:50}),m.moveTo(I,y).lineTo(I+100,y).stroke("#333333"),m.font("Helvetica").fontSize(10).text("Authorized Signature",I,y+5,{align:"center",width:100}),m.end()}catch(e){console.error("Error verifying certificate:",e),t.status(500).json({message:"Error generating certificate",error:e.message})}}a=(u.then?(await u)():u)[0],n()}catch(e){n(e)}})},29021:e=>{e.exports=require("fs")},33480:(e,t,i)=>{e.exports=i(75600)},33873:e=>{e.exports=require("path")},37830:(e,t,i)=>{i.a(e,async(e,n)=>{try{i.r(t),i.d(t,{config:()=>f,default:()=>l,routeModule:()=>d});var r=i(33480),o=i(8667),a=i(86435),c=i(20862),s=e([c]);c=(s.then?(await s)():s)[0];let l=(0,a.M)(c,"default"),f=(0,a.M)(c,"config"),d=new r.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/certificate/generate",pathname:"/api/certificate/generate",bundlePath:"",filename:""},userland:c});n()}catch(e){n(e)}})},56037:e=>{e.exports=require("mongoose")},64689:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(56037),r=i.n(n);if(!process.env.MONGO_URI)throw Error("Please define the MONGO_URI environment variable");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let a=async function(){return o.conn||(o.promise||(o.promise=r().connect(process.env.MONGO_URI).then(e=>e.connection)),o.conn=await o.promise),o.conn}},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},81278:e=>{e.exports=require("pdfkit")},86435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var i=t(t.s=37830);module.exports=i})();