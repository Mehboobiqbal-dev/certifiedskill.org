module.exports = {

"[externals]/next/dist/compiled/next-server/pages-api.runtime.dev.js [external] (next/dist/compiled/next-server/pages-api.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/pages-api.runtime.dev.js", () => require("next/dist/compiled/next-server/pages-api.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/react/jsx-dev-runtime [external] (react/jsx-dev-runtime, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("react/jsx-dev-runtime", () => require("react/jsx-dev-runtime"));

module.exports = mod;
}}),
"[externals]/react [external] (react, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("react", () => require("react"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/react/jsx-runtime [external] (react/jsx-runtime, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("react/jsx-runtime", () => require("react/jsx-runtime"));

module.exports = mod;
}}),
"[externals]/react-dom [external] (react-dom, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("react-dom", () => require("react-dom"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/pages.runtime.dev.js [external] (next/dist/compiled/next-server/pages.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/pages.runtime.dev.js", () => require("next/dist/compiled/next-server/pages.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/head.js [external] (next/head.js, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/head.js", () => require("next/head.js"));

module.exports = mod;
}}),
"[externals]/next-auth/react [external] (next-auth/react, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next-auth/react", () => require("next-auth/react"));

module.exports = mod;
}}),
"[externals]/next-auth/next [external] (next-auth/next, cjs)": (function(__turbopack_context__) {

var { g: global, d: __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next-auth/next", () => require("next-auth/next"));

module.exports = mod;
}}),
"[project]/pages/api/exams/index.js [api] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, d: __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "default": (()=>ExamPage),
    "getServerSideProps": (()=>getServerSideProps)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/react/jsx-dev-runtime [external] (react/jsx-dev-runtime, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$react__$5b$external$5d$__$28$react$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/react [external] (react, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$router$2e$js__$5b$api$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/router.js [api] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$next$2f$head$2e$js__$5b$external$5d$__$28$next$2f$head$2e$js$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/next/head.js [external] (next/head.js, cjs)");
(()=>{
    const e = new Error("Cannot find module '../../components/AntiCheating'");
    e.code = 'MODULE_NOT_FOUND';
    throw e;
})();
var __TURBOPACK__imported__module__$5b$externals$5d2f$next$2d$auth$2f$react__$5b$external$5d$__$28$next$2d$auth$2f$react$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/next-auth/react [external] (next-auth/react, cjs)");
// Import NextAuth server-side helper and your auth options
var __TURBOPACK__imported__module__$5b$externals$5d2f$next$2d$auth$2f$next__$5b$external$5d$__$28$next$2d$auth$2f$next$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/next-auth/next [external] (next-auth/next, cjs)");
(()=>{
    const e = new Error("Cannot find module '../../app/api/auth/[...nextauth]/authOptions'");
    e.code = 'MODULE_NOT_FOUND';
    throw e;
})();
(()=>{
    const e = new Error("Cannot find module '../../lib/db'");
    e.code = 'MODULE_NOT_FOUND';
    throw e;
})();
(()=>{
    const e = new Error("Cannot find module '../../models/exam'");
    e.code = 'MODULE_NOT_FOUND';
    throw e;
})();
;
;
;
;
;
;
;
;
;
;
function ExamPage({ exam }) {
    const { data: session, status } = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$next$2d$auth$2f$react__$5b$external$5d$__$28$next$2d$auth$2f$react$2c$__cjs$29$__["useSession"])();
    const router = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$router$2e$js__$5b$api$5d$__$28$ecmascript$29$__["useRouter"])();
    // Record the user's selected answers.
    const [userAnswers, setUserAnswers] = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react__$5b$external$5d$__$28$react$2c$__cjs$29$__["useState"])({});
    // Track whether the exam is submitted.
    const [submitted, setSubmitted] = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react__$5b$external$5d$__$28$react$2c$__cjs$29$__["useState"])(false);
    // For cheating detection.
    const [cheatingCount, setCheatingCount] = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react__$5b$external$5d$__$28$react$2c$__cjs$29$__["useState"])(0);
    // Total time taken (in seconds) across all questions.
    const [timeTaken, setTimeTaken] = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react__$5b$external$5d$__$28$react$2c$__cjs$29$__["useState"])(0);
    // For per-question handling:
    const QUESTION_TIME = 20; // seconds per question
    const [currentQuestionIndex, setCurrentQuestionIndex] = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react__$5b$external$5d$__$28$react$2c$__cjs$29$__["useState"])(0);
    const [questionTimeLeft, setQuestionTimeLeft] = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react__$5b$external$5d$__$28$react$2c$__cjs$29$__["useState"])(QUESTION_TIME);
    // ---------------------
    // Timer effect for each question.
    (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react__$5b$external$5d$__$28$react$2c$__cjs$29$__["useEffect"])(()=>{
        if (submitted) return;
        // Set up a timer that ticks every second.
        const timer = setInterval(()=>{
            setQuestionTimeLeft((prevTime)=>{
                if (prevTime <= 1) {
                    proceedToNextQuestion(); // timeâ€™s up for this question: move on
                    return QUESTION_TIME; // reset timer for next (if any)
                }
                return prevTime - 1;
            });
        }, 1000);
        return ()=>{
            clearInterval(timer);
        };
    }, [
        submitted,
        currentQuestionIndex
    ]);
    // Proceed to next question
    const proceedToNextQuestion = ()=>{
        // Increment total time taken by adding the elapsed time for this question.
        setTimeTaken((prev)=>prev + (QUESTION_TIME - questionTimeLeft));
        // If the current question is the last one, then submit the exam; otherwise move on.
        if (currentQuestionIndex < exam.questions.length - 1) {
            setCurrentQuestionIndex((prev)=>prev + 1);
            setQuestionTimeLeft(QUESTION_TIME);
        } else {
            // End the exam
            handleSubmit();
        }
    };
    // Called when the user selects an option.
    const handleOptionChange = (selectedOption)=>{
        // Record answer for the current question.
        setUserAnswers((prev)=>({
                ...prev,
                [currentQuestionIndex]: selectedOption
            }));
        // Immediately move to the next question.
        proceedToNextQuestion();
    };
    // When the exam is finished.
    const handleSubmit = async ()=>{
        if (submitted) return;
        setSubmitted(true);
        // Calculate the score.
        const correctCount = exam.questions.reduce((count, question, idx)=>{
            return userAnswers[idx] === question.correctAnswer ? count + 1 : count;
        }, 0);
        const total = exam.questions.length;
        // Here a passing score threshold is provided (modify as needed)
        const passingScore = 40;
        const passed = correctCount >= passingScore;
        // Aggregate the result including total time from each question.
        const resultData = {
            userId: session?.user?.id,
            examId: exam._id,
            userName: session?.user?.name,
            examName: exam.title,
            score: correctCount,
            total,
            passed,
            timeTaken,
            cheatingCount,
            createdAt: new Date()
        };
        await onExamSubmit(resultData);
    };
    const handleCheatingDetected = ()=>{
        setCheatingCount((prev)=>prev + 1);
    };
    // If the exam has no questions (unlikely) or hasn't loaded.
    if (!exam.questions || exam.questions.length === 0) {
        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("p", {
            children: "No questions found."
        }, void 0, false, {
            fileName: "[project]/pages/api/exams/index.js",
            lineNumber: 115,
            columnNumber: 12
        }, this);
    }
    // Only show the current question.
    const currentQuestion = exam.questions[currentQuestionIndex];
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("div", {
        className: "relative",
        children: status === "loading" ? /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("p", {
            children: "Loading..."
        }, void 0, false, {
            fileName: "[project]/pages/api/exams/index.js",
            lineNumber: 124,
            columnNumber: 9
        }, this) : /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["Fragment"], {
            children: [
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])(AntiCheating, {
                    onCheatingDetected: handleCheatingDetected
                }, void 0, false, {
                    fileName: "[project]/pages/api/exams/index.js",
                    lineNumber: 127,
                    columnNumber: 11
                }, this),
                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("div", {
                    className: "p-6 max-w-3xl mx-auto",
                    children: [
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$externals$5d2f$next$2f$head$2e$js__$5b$external$5d$__$28$next$2f$head$2e$js$2c$__cjs$29$__["default"], {
                            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("title", {
                                children: exam.title
                            }, void 0, false, {
                                fileName: "[project]/pages/api/exams/index.js",
                                lineNumber: 130,
                                columnNumber: 15
                            }, this)
                        }, void 0, false, {
                            fileName: "[project]/pages/api/exams/index.js",
                            lineNumber: 129,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("h1", {
                            className: "text-3xl font-bold mb-6",
                            children: exam.title
                        }, void 0, false, {
                            fileName: "[project]/pages/api/exams/index.js",
                            lineNumber: 132,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("h2", {
                            className: "text-xl mb-4",
                            children: [
                                "Question ",
                                currentQuestionIndex + 1,
                                " of ",
                                exam.questions.length
                            ]
                        }, void 0, true, {
                            fileName: "[project]/pages/api/exams/index.js",
                            lineNumber: 133,
                            columnNumber: 13
                        }, this),
                        /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("div", {
                            className: "bg-white shadow-md rounded-lg p-4 mb-6 border border-gray-200",
                            children: [
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("p", {
                                    className: "text-lg font-medium mb-3",
                                    children: currentQuestion.questionText
                                }, void 0, false, {
                                    fileName: "[project]/pages/api/exams/index.js",
                                    lineNumber: 137,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("div", {
                                    children: currentQuestion.options.map((option, i)=>/*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("label", {
                                            className: "block p-2 mb-2 border rounded cursor-pointer hover:bg-gray-100",
                                            onClick: ()=>handleOptionChange(option),
                                            children: [
                                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("input", {
                                                    type: "radio",
                                                    name: `question-${currentQuestionIndex}`,
                                                    value: option,
                                                    className: "mr-2",
                                                    readOnly: true
                                                }, void 0, false, {
                                                    fileName: "[project]/pages/api/exams/index.js",
                                                    lineNumber: 147,
                                                    columnNumber: 21
                                                }, this),
                                                option
                                            ]
                                        }, i, true, {
                                            fileName: "[project]/pages/api/exams/index.js",
                                            lineNumber: 142,
                                            columnNumber: 19
                                        }, this))
                                }, void 0, false, {
                                    fileName: "[project]/pages/api/exams/index.js",
                                    lineNumber: 140,
                                    columnNumber: 15
                                }, this),
                                /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("div", {
                                    className: "mt-3",
                                    children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$externals$5d2f$react$2f$jsx$2d$dev$2d$runtime__$5b$external$5d$__$28$react$2f$jsx$2d$dev$2d$runtime$2c$__cjs$29$__["jsxDEV"])("p", {
                                        className: "text-sm text-gray-500",
                                        children: [
                                            "Time left for this question: ",
                                            questionTimeLeft,
                                            " seconds"
                                        ]
                                    }, void 0, true, {
                                        fileName: "[project]/pages/api/exams/index.js",
                                        lineNumber: 159,
                                        columnNumber: 17
                                    }, this)
                                }, void 0, false, {
                                    fileName: "[project]/pages/api/exams/index.js",
                                    lineNumber: 158,
                                    columnNumber: 15
                                }, this)
                            ]
                        }, void 0, true, {
                            fileName: "[project]/pages/api/exams/index.js",
                            lineNumber: 136,
                            columnNumber: 13
                        }, this)
                    ]
                }, void 0, true, {
                    fileName: "[project]/pages/api/exams/index.js",
                    lineNumber: 128,
                    columnNumber: 11
                }, this)
            ]
        }, void 0, true)
    }, void 0, false, {
        fileName: "[project]/pages/api/exams/index.js",
        lineNumber: 122,
        columnNumber: 5
    }, this);
}
// onExamSubmit: Submits exam results and triggers certificate generation if passed.
async function onExamSubmit(resultData) {
    try {
        // Save exam result.
        const resultRes = await fetch("/api/exams/result", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(resultData),
            cache: "no-store"
        });
        const resultJson = await resultRes.json();
        if (!resultRes.ok) {
            console.error(resultJson.message);
            return;
        }
        // If passed, automatically generate certificate.
        if (resultData.passed) {
            const certRes = await fetch("/api/certificate/generate", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    userId: resultData.userId,
                    examId: resultData.examId,
                    userName: resultData.userName,
                    examName: resultData.examName,
                    passed: resultData.passed
                }),
                cache: "no-store"
            });
            const certJson = await certRes.json();
            if (certRes.ok) {
                alert("Certificate generated! Certificate Number: " + certJson.certificateNumber);
            // Optionally: redirect or handle certificate presentation.
            } else {
                console.error(certJson.message);
            }
        }
    } catch (error) {
        console.error("Submission error:", error);
    }
}
async function getServerSideProps(context) {
    // Verify user is authenticated.
    const session = await (0, __TURBOPACK__imported__module__$5b$externals$5d2f$next$2d$auth$2f$next__$5b$external$5d$__$28$next$2d$auth$2f$next$2c$__cjs$29$__["getServerSession"])(context.req, context.res, authOptions);
    if (!session) {
        return {
            redirect: {
                destination: "/sign-in",
                permanent: false
            }
        };
    }
    try {
        await connectToDatabase();
        const exam = await Exam.findById(context.params.id);
        if (!exam || !exam.questions) {
            return {
                notFound: true
            };
        }
        // Convert exam data for Next.js.
        const examObj = JSON.parse(JSON.stringify(exam));
        return {
            props: {
                exam: examObj
            }
        };
    } catch (error) {
        console.error("Error fetching exam:", error);
        return {
            notFound: true
        };
    }
}
}}),

};

//# sourceMappingURL=%5Broot%20of%20the%20server%5D__3b7ea5bf._.js.map