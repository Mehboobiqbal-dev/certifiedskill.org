(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[781],{5546:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/exam/[id]",function(){return s(6902)}])},6902:(e,t,s)=>{"use strict";s.r(t),s.d(t,{__N_SSP:()=>d,default:()=>m});var n=s(7876),r=s(4232),a=s(4e3),i=s(7328),c=s.n(i),l=s(6768);let o=function(e){let{onCheatingDetected:t}=e,s=(0,r.useRef)(null),[a,i]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e;if(!s.current)return;let n=new l.FaceDetection({locateFile:e=>"https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/".concat(e)});return n.setOptions({model:"short",minDetectionConfidence:.5}),n.onResults(e=>{e.detections&&0!==e.detections.length?i(!1):(i(!0),t())}),new Promise((e,t)=>{if(document.getElementById("mediapipe-camera-utils"))e();else{let s=document.createElement("script");s.src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js",s.id="mediapipe-camera-utils",s.async=!0,s.onload=()=>e(),s.onerror=()=>t(Error("Failed to load Camera Utils script.")),document.body.appendChild(s)}}).then(()=>{s.current&&window.Camera&&(e=new window.Camera(s.current,{onFrame:async()=>{await n.send({image:s.current})},width:640,height:480})).start()}).catch(e=>console.error(e)),()=>{e&&e.stop&&e.stop()}},[t]),(0,n.jsxs)("div",{children:[(0,n.jsx)("video",{ref:s,className:"hidden",playsInline:!0}),a&&(0,n.jsx)("div",{className:"fixed top-4 left-4 bg-red-600 text-white px-4 py-2 rounded shadow-md",children:"Warning: Cheating Detected!"})]})};var d=!0;function m(e){let{exam:t}=e;(0,a.useRouter)();let[s,i]=(0,r.useState)({}),[l,d]=(0,r.useState)(!1),[m,u]=(0,r.useState)(2400),[h,p]=(0,r.useState)(0),[x,f]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(l)return;let e=setInterval(()=>{u(t=>t<=1?(clearInterval(e),b(),0):t-1)},1e3);return()=>clearInterval(e)},[l]);let w=(e,t)=>{i(s=>({...s,[e]:t}))},b=async e=>{if(e&&e.preventDefault&&e.preventDefault(),l)return;d(!0);let n=t.questions.reduce((e,t,n)=>s[n]===t.correctAnswer?e+1:e,0),r=t.questions.length,a=2400-m;f(a);let i={examId:t._id,score:n,total:r,passed:n>=40,timeTaken:a,cheatingCount:h,createdAt:new Date};try{await fetch("/api/exams/result",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}catch(e){console.error("Failed to save exam result:",e)}},g=(e,t,n)=>l?t===e.correctAnswer?"bg-green-100":s[n]===t&&t!==e.correctAnswer?"bg-red-100":"":"cursor-pointer",j=Math.floor(m/60),N=m%60,v=t.questions.reduce((e,t,n)=>s[n]===t.correctAnswer?e+1:e,0);return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(o,{onCheatingDetected:()=>{p(e=>e+1)}}),!l&&(0,n.jsxs)("div",{className:"fixed top-4 right-4 bg-blue-600 text-white px-4 py-2 rounded shadow-md",children:["Time Remaining: ",j,":",N<10?"0".concat(N):N]}),(0,n.jsxs)("div",{className:"p-6 max-w-3xl mx-auto",children:[(0,n.jsx)(c(),{children:(0,n.jsx)("title",{children:t.title})}),(0,n.jsx)("h1",{className:"text-3xl font-bold mb-6",children:t.title}),(0,n.jsxs)("form",{onSubmit:b,children:[t.questions.map((e,t)=>(0,n.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-4 mb-6 border border-gray-200",children:[(0,n.jsx)("p",{className:"text-lg font-medium mb-3",children:e.questionText}),(0,n.jsx)("div",{children:e.options.map((r,a)=>(0,n.jsxs)("label",{className:"block p-2 mb-2 border rounded ".concat(g(e,r,t)),children:[(0,n.jsx)("input",{type:"radio",name:"question-".concat(t),value:r,checked:s[t]===r,onChange:()=>w(t,r),className:"mr-2",disabled:l}),r]},a))}),l&&(0,n.jsx)("p",{className:"mt-2",children:s[t]===e.correctAnswer?(0,n.jsx)("span",{className:"text-green-600 font-semibold",children:"Correct!"}):(0,n.jsxs)("span",{className:"text-red-600 font-semibold",children:["Incorrect. Correct answer: ",e.correctAnswer]})})]},t)),!l&&(0,n.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-2 rounded",children:"Submit Answers"}),l&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("p",{className:"text-xl font-bold",children:["You got ",v," out of ",t.questions.length," correct!"]}),(0,n.jsx)("p",{className:"text-lg",children:v>=40?"Congratulations! You have passed the exam.":"Sorry, you did not pass the exam."}),null!==x&&(0,n.jsxs)("p",{className:"text-lg",children:["Time Taken: ",Math.floor(x/60)," minutes ",x%60," seconds."]}),(0,n.jsxs)("p",{className:"text-lg",children:["Cheating Attempts: ",h]})]})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[0,355,636,593,792],()=>t(5546)),_N_E=e.O()}]);