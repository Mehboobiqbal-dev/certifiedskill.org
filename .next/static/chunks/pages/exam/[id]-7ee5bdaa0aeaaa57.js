(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[781],{5546:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/exam/[id]",function(){return s(6902)}])},6902:(e,t,s)=>{"use strict";s.r(t),s.d(t,{__N_SSP:()=>u,default:()=>c});var n=s(7876),a=s(4232),i=s(9099),r=s(7328),o=s.n(r);let l=function(e){let t,{onCheatingDetected:s,detectionThreshold:i=3e3}=e,[r,o]=(0,a.useState)(!1),[l,d]=(0,a.useState)(0);return(0,a.useEffect)(()=>{let e=()=>{document.hidden?t=setTimeout(()=>{o(!0),d(e=>e+1),s()},i):(clearTimeout(t),o(!1))},n=()=>{t=setTimeout(()=>{o(!0),d(e=>e+1),s()},i)},a=()=>{clearTimeout(t),o(!1)},r=e=>{e.clientY<=0&&(o(!0),d(e=>e+1),s())};return document.addEventListener("visibilitychange",e),window.addEventListener("blur",n),window.addEventListener("focus",a),document.addEventListener("mouseleave",r),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("blur",n),window.removeEventListener("focus",a),document.removeEventListener("mouseleave",r),clearTimeout(t)}},[s,i]),(0,n.jsx)(n.Fragment,{children:r&&(0,n.jsxs)("div",{className:"fixed top-4 left-4 bg-red-600 text-black px-4 py-2 rounded shadow-md",children:["Warning: Cheating Detected! (Count: ",l,")"]})})};var d=s(553),u=!0;function c(e){let{exam:t}=e,{data:s,status:r}=(0,d.useSession)();(0,i.useRouter)();let[u,c]=(0,a.useState)({}),[h,x]=(0,a.useState)(!1),[v,p]=(0,a.useState)(0),[b,f]=(0,a.useState)(0),[g,w]=(0,a.useState)(0),[N,j]=(0,a.useState)(20);(0,a.useEffect)(()=>{if(h)return;let e=setInterval(()=>{j(e=>e<=1?g===t.questions.length-1?(_(),0):(y(),20):e-1)},1e3);return()=>clearInterval(e)},[h,g]);let y=()=>{f(e=>e+(20-N)),g<t.questions.length-1&&(w(e=>e+1),j(20))},S=e=>{c(t=>({...t,[g]:e})),g<t.questions.length-1&&y()},_=async()=>{var e,n;if(h)return;x(!0);let a=t.questions.reduce((e,t,s)=>u[s]===t.correctAnswer?e+1:e,0),i=t.questions.length,r={userId:null==s?void 0:null===(e=s.user)||void 0===e?void 0:e.id,examId:t._id,userName:null==s?void 0:null===(n=s.user)||void 0===n?void 0:n.name,examName:t.title,score:a,total:i,passed:a>=40,timeTaken:b,cheatingCount:v,createdAt:new Date};await m(r)};if(!t.questions||0===t.questions.length)return(0,n.jsx)("p",{children:"No questions found."});let E=t.questions[g];return(0,n.jsx)("div",{className:"relative",children:"loading"===r?(0,n.jsx)("p",{children:"Loading..."}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l,{onCheatingDetected:()=>{p(e=>e+1)}}),(0,n.jsxs)("div",{className:"p-6 max-w-3xl mx-auto",children:[(0,n.jsx)(o(),{children:(0,n.jsx)("title",{children:t.title})}),(0,n.jsx)("h1",{className:"text-3xl font-bold mb-6",children:t.title}),(0,n.jsxs)("h2",{className:"text-xl mb-4",children:["Question ",g+1," of ",t.questions.length]}),(0,n.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-4 mb-6 border border-gray-200",children:[(0,n.jsx)("p",{className:"text-lg font-medium mb-3",children:E.questionText}),(0,n.jsx)("div",{children:E.options.map((e,t)=>(0,n.jsxs)("label",{className:"block p-2 mb-2 border rounded cursor-pointer hover:bg-gray-100",children:[(0,n.jsx)("input",{type:"radio",name:"question-".concat(g),value:e,onChange:()=>S(e),checked:u[g]===e,className:"mr-2"}),e]},t))}),(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["Time left for this question: ",N," seconds"]})}),g===t.questions.length-1&&(0,n.jsx)("button",{onClick:()=>{_()},className:"px-6 py-2 mt-4 text-black bg-blue-500 hover:bg-blue-600 rounded shadow",children:"Submit"})]})]})]})})}async function m(e){try{let t=await fetch("/api/exams/result",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),cache:"no-store"}),s=await t.json();if(!t.ok){console.error(s.message);return}if(e.passed){let t=await fetch("/api/certificate/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.userId,examId:e.examId,userName:e.userName,examName:e.examName,passed:e.passed}),cache:"no-store"});if(t.ok){let e=await t.blob(),s=window.URL.createObjectURL(e);window.open(s,"_blank")}else{let e=await t.json();console.error(e.message)}}else alert("You did not pass the exam.")}catch(e){console.error("Submission error:",e)}}},7328:(e,t,s)=>{e.exports=s(5679)},9099:(e,t,s)=>{e.exports=s(4294)}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(5546)),_N_E=e.O()}]);