(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[204],{7328:(e,t,s)=>{e.exports=s(5679)},7553:(e,t,s)=>{"use strict";s.r(t),s.d(t,{__N_SSP:()=>u,default:()=>m});var n=s(7876),a=s(4232),r=s(9099),i=s(7328),o=s.n(i);let l=function(e){let t,{onCheatingDetected:s,detectionThreshold:r=3e3}=e,[i,o]=(0,a.useState)(!1),[l,d]=(0,a.useState)(0);return(0,a.useEffect)(()=>{let e=()=>{document.hidden?t=setTimeout(()=>{o(!0),d(e=>e+1),s()},r):(clearTimeout(t),o(!1))},n=()=>{t=setTimeout(()=>{o(!0),d(e=>e+1),s()},r)},a=()=>{clearTimeout(t),o(!1)},i=e=>{e.clientY<=0&&(o(!0),d(e=>e+1),s())};return document.addEventListener("visibilitychange",e),window.addEventListener("blur",n),window.addEventListener("focus",a),document.addEventListener("mouseleave",i),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("blur",n),window.removeEventListener("focus",a),document.removeEventListener("mouseleave",i),clearTimeout(t)}},[s,r]),(0,n.jsx)(n.Fragment,{children:i&&(0,n.jsxs)("div",{className:"fixed top-4 left-4 bg-green-600 text-green px-8 py-8 rounded shadow-md",children:["Warning: Cheating Detected! (Count: ",l,")"]})})};var d=s(553),c=s(9688),u=!0;function m(e){let{exam:t}=e,{data:s,status:i}=(0,d.useSession)(),c=(0,r.useRouter)();(0,a.useEffect)(()=>{"loading"===i||s||c.push("/sign-in")},[s,i,c]);let[u,m]=(0,a.useState)({}),[x,g]=(0,a.useState)(!1),[p,f]=(0,a.useState)(0),[w,b]=(0,a.useState)(0),[N,y]=(0,a.useState)(0),[v,j]=(0,a.useState)(20);(0,a.useEffect)(()=>{if(x)return;let e=setInterval(()=>{j(e=>e<=1?N===t.questions.length-1?(_(),0):(E(),20):e-1)},1e3);return()=>clearInterval(e)},[x,N]);let E=()=>{b(e=>e+(20-v)),N<t.questions.length-1&&(y(e=>e+1),j(20))},S=e=>{m(t=>({...t,[N]:e})),N<t.questions.length-1&&E()},_=async()=>{if(x)return;g(!0);let e=t.questions.reduce((e,t,s)=>u[s]===t.correctAnswer?e+1:e,0),n=t.questions.length,a={userId:s.user.id,examId:t._id,userName:s.user.name,examName:t.title,score:e,total:n,passed:e>=40,timeTaken:w,cheatingCount:p,createdAt:new Date};await h(a)};if(!t.questions||0===t.questions.length)return(0,n.jsx)("p",{className:"text-center mt-20 text-gray-600",children:"No questions found."});let T=t.questions[N];return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)(l,{onCheatingDetected:()=>{f(e=>e+1)}}),(0,n.jsx)(o(),{children:(0,n.jsxs)("title",{children:[t.title," | Exam Portal"]})}),(0,n.jsx)("header",{className:"bg-white shadow py-4",children:(0,n.jsx)("div",{className:"container mx-auto px-4",children:(0,n.jsx)("h1",{className:"text-2xl font-semibold text-gray-800",children:t.title})})}),(0,n.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,n.jsxs)("div",{className:"max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-lg",children:[(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("h2",{className:"text-xl font-medium text-gray-700",children:["Question ",N+1," of ",t.questions.length]}),(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,n.jsx)("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-500",style:{width:"".concat(v/20*100,"%")}})}),(0,n.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Time remaining: ",v," seconds"]})]})]}),(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)("p",{className:"text-lg text-gray-800 font-semibold",children:T.questionText})}),(0,n.jsx)("div",{className:"space-y-4",children:T.options.map((e,t)=>(0,n.jsxs)("label",{className:"flex items-center p-4 border rounded-lg cursor-pointer transition-colors \n                  ".concat(u[N]===e?"border-indigo-600 bg-indigo-50":"border-gray-300 bg-white"),children:[(0,n.jsx)("input",{type:"radio",name:"question-".concat(N),value:e,onChange:()=>S(e),checked:u[N]===e,className:"form-radio h-5 w-5 text-indigo-600 mr-3"}),(0,n.jsx)("span",{className:"text-gray-700",children:e})]},t))}),N===t.questions.length-1&&(0,n.jsx)("button",{onClick:()=>{_()},className:"mt-8 w-full py-3 text-black bg-indigo-600 hover:bg-indigo-700 rounded-lg shadow transition-colors",children:"Submit Exam"})]})})]})}async function h(e){try{let t=await fetch("/api/exams/result",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),cache:"no-store"}),s=await t.json();if(!t.ok){c.oR.error(s.message||"Error submitting your exam results. Please try again later."),console.error(s.message);return}if(e.passed){c.oR.success("Congratulations! You passed the exam. Your certificate is being generated.");let t=await fetch("/api/certificate/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.userId,examId:e.examId,userName:e.userName,examName:e.examName,passed:e.passed}),cache:"no-store"});if(t.ok){let e=await t.blob(),s=window.URL.createObjectURL(e);window.open(s,"_blank")}else{let e=await t.json();c.oR.error("There was an error generating your certificate. Please try again later."),console.error(e.message)}}else c.oR.error("Unfortunately, you did not pass the exam. Please try again.")}catch(e){c.oR.error("An unexpected error occurred during submission. Please contact support."),console.error("Submission error:",e)}}},9099:(e,t,s)=>{e.exports=s(4294)},9972:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/exam/[id]/start",function(){return s(7553)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(9972)),_N_E=e.O()}]);