(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[781],{3673:(e,t,s)=>{"use strict";s.r(t),s.d(t,{__N_SSP:()=>o,default:()=>d});var n=s(7876),r=s(6768),a=s(4232),i=s(7328),c=s.n(i);function l(e){let{onCheatingDetected:t}=e,s=(0,a.useRef)(null),[i,c]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{let e;if(!s.current)return;let n=new r.FaceDetection({locateFile:e=>"https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/".concat(e)});return n.setOptions({model:"short",minDetectionConfidence:.5}),n.onResults(e=>{e.detections&&0!==e.detections.length?c(!1):(c(!0),t())}),new Promise((e,t)=>{if(document.getElementById("mediapipe-camera-utils"))e();else{let s=document.createElement("script");s.src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js",s.id="mediapipe-camera-utils",s.async=!0,s.onload=()=>e(),s.onerror=()=>t(Error("Failed to load Camera Utils script.")),document.body.appendChild(s)}}).then(()=>{s.current&&window.Camera&&(e=new window.Camera(s.current,{onFrame:async()=>{await n.send({image:s.current})},width:640,height:480})).start()}).catch(e=>console.error(e)),()=>{e&&e.stop&&e.stop()}},[t]),(0,n.jsxs)("div",{children:[(0,n.jsx)("video",{ref:s,className:"hidden"}),i&&(0,n.jsx)("div",{className:"fixed top-4 left-4 bg-red-600 text-white px-4 py-2 rounded shadow-md",children:"Warning: Cheating Detected!"})]})}var o=!0;function d(e){let{exam:t}=e,[s,r]=(0,a.useState)({}),[i,o]=(0,a.useState)(!1),[d,m]=(0,a.useState)(2400),[u,h]=(0,a.useState)(0),[p,x]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(i)return;let e=setInterval(()=>{m(t=>t<=1?(clearInterval(e),w(),0):t-1)},1e3);return()=>clearInterval(e)},[i]);let f=(e,t)=>{r(s=>({...s,[e]:t}))},w=async e=>{if(e&&e.preventDefault&&e.preventDefault(),i)return;o(!0);let n=t.questions.reduce((e,t,n)=>s[n]===t.correctAnswer?e+1:e,0),r=t.questions.length,a=2400-d;x(a);let c={examId:t._id,score:n,total:r,passed:n>=40,timeTaken:a,cheatingCount:u,createdAt:new Date};try{await fetch("/api/exams/result",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})}catch(e){console.error("Failed to save exam result:",e)}},g=(e,t,n)=>i?t===e.correctAnswer?"bg-green-100":s[n]===t&&t!==e.correctAnswer?"bg-red-100":"":"cursor-pointer",b=Math.floor(d/60),j=d%60,N=t.questions.reduce((e,t,n)=>s[n]===t.correctAnswer?e+1:e,0);return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(l,{onCheatingDetected:()=>{h(e=>e+1)}}),!i&&(0,n.jsxs)("div",{className:"fixed top-4 right-4 bg-blue-600 text-white px-4 py-2 rounded shadow-md",children:["Time Remaining: ",b,":",j<10?"0".concat(j):j]}),(0,n.jsxs)("div",{className:"p-6 max-w-3xl mx-auto",children:[(0,n.jsx)(c(),{children:(0,n.jsx)("title",{children:t.title})}),(0,n.jsx)("h1",{className:"text-3xl font-bold mb-6",children:t.title}),(0,n.jsxs)("form",{onSubmit:w,children:[t.questions.map((e,t)=>(0,n.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-4 mb-6 border border-gray-200",children:[(0,n.jsx)("p",{className:"text-lg font-medium mb-3",children:e.questionText}),(0,n.jsx)("div",{children:e.options.map((r,a)=>(0,n.jsxs)("label",{className:"block p-2 mb-2 border rounded ".concat(g(e,r,t)),children:[(0,n.jsx)("input",{type:"radio",name:"question-".concat(t),value:r,checked:s[t]===r,onChange:()=>f(t,r),className:"mr-2",disabled:i}),r]},a))}),i&&(0,n.jsx)("p",{className:"mt-2",children:s[t]===e.correctAnswer?(0,n.jsx)("span",{className:"text-green-600 font-semibold",children:"Correct!"}):(0,n.jsxs)("span",{className:"text-red-600 font-semibold",children:["Incorrect. Correct answer: ",e.correctAnswer]})})]},t)),!i&&(0,n.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-2 rounded",children:"Submit Answers"}),i&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("p",{className:"text-xl font-bold",children:["You got ",N," out of ",t.questions.length," correct!"]}),(0,n.jsx)("p",{className:"text-lg",children:N>=passingScore?"Congratulations! You have passed the exam.":"Sorry, you did not pass the exam."}),null!==p&&(0,n.jsxs)("p",{className:"text-lg",children:["Time Taken: ",Math.floor(p/60)," minutes ",p%60," seconds."]}),(0,n.jsxs)("p",{className:"text-lg",children:["Cheating Attempts: ",u]})]})]})]})]})}},5546:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/exam/[id]",function(){return s(3673)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[355,636,593,792],()=>t(5546)),_N_E=e.O()}]);